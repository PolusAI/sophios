steps:
  - gmxselect: # NOTE: make_ndx does NOT work! (It erroneously selects all of the atoms.)
      in:
        input_structure_path: '*min.tpr'
        #config: '{"selection": "group Protein"}'
        output_ndx_path: '&solute.ndx'
  - gmx_image:
      in:
        input_crd_path: '*prod.gro'
        input_top_path: '*prod.tpr'
        # NOTE: If you use an index file, it removes the default System selection.
        # Thus, you must specify all three selections (either explicitly here, or via overloading).
        input_index_path: '*solute.ndx'
        #config:
        #  fit_selection: Protein
        #  center_selection: Protein
        #  output_selection: Protein
# Temporarily use explicit index file
# Due to a bug in 3.9.0, input_index_path is required.
# See https://github.com/bioexcel/biobb_analysis/commit/2c08146ea8d7492ee67ea55720e6e77e7a8ff732
# and https://github.com/bioexcel/biobb_analysis/commit/596d71c918a515786ed1d8b89f6a6f0357fc98f8
# The bug has been fixed in master, but there are no newer docker images available.
# See https://quay.io/repository/biocontainers/biobb_analysis?tab=tags&tag=latest
  - make_ndx:
      in:
        input_structure_path: '*min.tpr'
        output_ndx_path: '&allatomsmin.ndx'
  - gmx_trjconv_str:
      in:
        #config:
        #  selection: System
        input_top_path: '*prod.tpr'
        input_crd_path: '*prod.gro'
        input_index_path: '*allatomsmin.ndx'
        output_str_path: '&prod.pdb'

wic:
  graphviz:
    label: Final Analysis
  steps:
    (1, gmxselect):
      wic:
        graphviz:
          label: Select Atom Indices
    (2, gmx_image):
      wic:
        graphviz:
          label: Wrap Periodic\nFinal Coordinates
    (4, gmx_trjconv_str):
      wic:
        graphviz:
          label: Extract Protein\nFinal Coordinates